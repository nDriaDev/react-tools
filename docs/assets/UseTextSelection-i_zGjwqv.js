import{r as o,j as u}from"./index-d1B4j_sD.js";import{u as b}from"./useSyncExternalStore-muWJblcI.js";import{i as y}from"./isDeepEqual-miY4iMQs.js";const R=({target:e,onStart:t,onChange:i,onEnd:r}={})=>{const l=o.useRef(!1),s=o.useRef(null),m=o.useRef(),a=o.useRef(null),h=o.useCallback(c=>{const n=e?e!=null&&e.current?e.current:e:document.body;a.current=g(n??document.body),r&&r(c),m.current&&m.current()},[r,e]),v=o.useCallback(()=>{l.current=!0,s.current=null},[]),d=o.useCallback(c=>{l.current=!1,(getSelection()??"").toString()===s.current&&(s.current=null,h(c))},[h]),x=o.useCallback(c=>{l.current=!0,t&&t(c),i&&document.addEventListener("selectionchange",i,{passive:!0})},[i,t]),p=o.useCallback(()=>{l.current=!1,s.current=(getSelection()??"").toString(),i&&document.removeEventListener("selectionchange",i)},[i]),f=o.useCallback(c=>{l.current&&(getSelection()??"").toString()===""&&(t&&t(c),i&&document.addEventListener("selectionchange",i,{passive:!0}))},[t,i]);return b(o.useCallback(c=>{m.current=c;const n=e?e!=null&&e.current?e.current:e:document.body;return document.addEventListener("pointerdown",v,{passive:!0}),document.addEventListener("pointerup",d,{passive:!0}),document.addEventListener("pointerleave",d,{passive:!0}),n&&n.addEventListener("pointerdown",x,{passive:!0}),n&&n.addEventListener("pointerup",p,{passive:!0}),n&&n.addEventListener("pointerleave",p,{passive:!0}),n&&n.addEventListener("pointerenter",f,{passive:!0}),()=>{document.removeEventListener("pointerdown",v),document.removeEventListener("pointerup",d),document.removeEventListener("pointerleave",d),n&&n.removeEventListener("pointerdown",x),n&&n.removeEventListener("pointerup",p),n&&n.removeEventListener("pointerleave",p),n&&n.removeEventListener("pointerenter",f)}},[v,d,x,p,f,e]),o.useMemo(()=>{let c=e?e!=null&&e.current?e.current:e:document.body,n=a.current;return()=>{const E=e?e!=null&&e.current?e.current:e:document.body;return(c!==E||!y(n,a.current))&&(c=E,n=a.current),n}},[e]))};function L(e){const t=e.anchorNode.compareDocumentPosition(e.focusNode);let i=!1;return(!t&&e.anchorOffset>e.focusOffset||t===Node.DOCUMENT_POSITION_PRECEDING)&&(i=!0),i?"backward":"forward"}function g(e){const t=window.getSelection();if(t===null||t.toString().trim()==="")return null;const i=e.getBoundingClientRect(),r=t.getRangeAt(0).getBoundingClientRect();return{text:t.toString(),direction:L(t),outsideRectangle:new DOMRect(r.x-i.x,r.y-i.y,r.width,r.height),innerRectangles:Array.from(t.getRangeAt(0).getClientRects()||[]).map(s=>(s.x=s.x-i.x,s.y=s.y-i.y,s))}}const D=()=>{const e=o.useRef(null),t=R({target:e,onEnd:()=>{var r;(r=getSelection())==null||r.removeAllRanges()}}),i=o.useMemo(()=>{if(t){const r=[];return r.push(u.jsx("div",{style:{position:"absolute",border:".5px solid red",top:t.outsideRectangle.top+"px",left:t.outsideRectangle.left+"px",width:t.outsideRectangle.width+"px",height:t.outsideRectangle.height+"px"}},"outside-rectangle")),t.innerRectangles.forEach((l,s)=>{r.push(u.jsx("div",{style:{position:"absolute",border:".5px solid darkcyan",top:l.top+"px",left:l.left+"px",width:l.width+"px",height:l.height+"px"}},"inner-rectangle-"+s))}),r}else return null},[t]);return u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"50% 50%",columnGap:15},children:[u.jsxs("div",{ref:e,style:{position:"relative",border:"1px solid lightgray"},children:[u.jsx("div",{children:u.jsx("p",{children:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Incidunt repudiandae fugit distinctio molestiae excepturi ex qui, impedit iste odit. Explicabo quis reprehenderit voluptates reiciendis nostrum minima autem temporibus sint doloribus"})}),u.jsx("div",{children:u.jsx("p",{children:"Lorem ipsum, dolor sit amet consectetur adipisicing elit. Incidunt repudiandae fugit distinctio molestiae excepturi ex qui, impedit iste odit. Explicabo quis reprehenderit voluptates reiciendis nostrum minima autem temporibus sint doloribus"})}),i]}),u.jsxs("div",{style:{textAlign:"left",padding:"0 1em",maxHeight:300,overflow:"auto",border:"1px solid lightgray"},children:[u.jsx("p",{children:u.jsx("strong",{children:"Selection:"})}),u.jsx("pre",{children:JSON.stringify(t,null,2)})]})]})};export{D as UseTextSelection};
