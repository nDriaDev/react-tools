import{r as n,j as u}from"./index-559a77ab.js";import{u as v}from"./useSyncExternalStore-d7963558.js";const y=({request:o,ref:l,hasMoreData:s,threshold:m,onBefore:a,onError:i,onSuccess:c})=>{const r=n.useRef(),t=n.useRef({data:void 0,loading:!0,fullData:!s()}),g=n.useCallback(()=>t.current.loading?Promise.resolve():(t.current.loading=!0,r.current&&r.current(),a&&a(),o(t.current.data).then(e=>{t.current.data=e,t.current.loading=!1,t.current.fullData=!s(e),r.current&&r.current(),c&&c()}).catch(e=>{t.current.loading=!1,r.current&&r.current(),i&&i(e)})),[a,c,i,o,s]),f=n.useCallback(e=>{if(t.current.loading||t.current.fullData)return;const d=e===document.documentElement?Math.max(window.scrollY,document.documentElement.scrollTop,document.body.scrollTop):e.scrollTop,h=e.scrollHeight||Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),b=e.clientHeight||Math.max(document.documentElement.clientHeight,document.body.clientHeight);h-d<=b+(m??0)&&g()},[g,m]),p=n.useCallback(e=>{t.current.data=e instanceof Function?e(t.current.data):e,r.current&&r.current()},[]),x=v(n.useCallback(e=>{r.current=e;const d=l.current,h=()=>f(d);return d&&d.addEventListener("scroll",h,{passive:!0}),()=>{r.current=void 0,d&&d.removeEventListener("scroll",h)}},[f,l]),n.useMemo(()=>{let e={loading:!0,fullData:t.current.fullData};return()=>(e.data!==t.current.data&&(e.data=t.current.data===void 0?void 0:Array.isArray(t.current.data)?[...t.current.data]:typeof t.current.data=="object"?{...t.current.data}:t.current.data,e={...t.current}),(e.loading!==t.current.loading||e.fullData!==t.current.fullData)&&(e={...t.current}),e)},[]));return n.useEffect(()=>{a&&a(),t.current.loading=!0,o().then(e=>{t.current.data=e,t.current.loading=!1,t.current.fullData=!s(e),r.current&&r.current(),c&&c()}).catch(e=>{t.current.loading=!1,r.current&&r.current(),i&&i(e)})},[o,i,a,c,s]),{data:x.data,loading:x.loading,fullData:x.fullData,updateData:p,loadData:g}},k=()=>{const o=n.useRef(null),l=n.useMemo(()=>Array(40).fill(void 0).map((r,t)=>t.toString()),[]),s=n.useCallback(r=>{let t;if(!r)t=l.slice(0,10);else{let f=0;r.length!==l.length&&(f=r.length);const p=f+10;t=[...r,...l.slice(f,p)]}return new Promise(g=>{setTimeout(()=>{g(t)},1e3)})},[l]),{data:m,loading:a,loadData:i,fullData:c}=y({request:s,ref:o,hasMoreData:n.useCallback(r=>(r||[]).length!==l.length,[l]),threshold:240});return u.jsxs(u.Fragment,{children:[u.jsx("h2",{style:{textAlign:"left"},children:"Items List"}),u.jsxs("div",{ref:o,style:{height:250,overflow:"auto",border:"1px solid",padding:12},children:[u.jsx("div",{children:m==null?void 0:m.map(r=>u.jsxs("div",{style:{padding:12,border:"1px solid #f5f5f5"},children:["item-",Number(r)+1]},r))}),u.jsxs("div",{style:{marginTop:8},children:[!c&&u.jsx("button",{type:"button",onClick:i,disabled:a,children:a?"Loading more...":"Click to load more"}),c&&u.jsx("span",{children:"No more data"})]})]})]})};export{k as UseInfiniteScroll};
