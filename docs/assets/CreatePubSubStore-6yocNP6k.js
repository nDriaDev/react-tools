import{r as h,j as a}from"./index-iAsfR5zi.js";import{u as E}from"./useSyncExternalStore-YQZLWzFY.js";import{P as R}from"./PublishSubscribePattern-aUbEeFKT.js";import{u as I}from"./useLazyRef-JiZ1oHvO.js";import{i as w}from"./isDeepEqual-miY4iMQs.js";let y=0;function S(t){return{get(s,r){t.push(r);const e=Reflect.get(s,r);return e==null||e instanceof Blob||e instanceof Date||e instanceof RegExp||e instanceof Map||e instanceof Set||typeof e!="object"?e:new Proxy(e,S(t))}}}function j(t,s,r,e){if(t===s){t[r]=e;return}for(const n in t)if(t[n]===s){Array.isArray(t[n])?t[n]=[...t[n]]:t[n]={...t[n]},t[n][r]=e;return}else if(Array.isArray(t[n])||typeof t[n]=="object")return j(t[n],s,r,e)}const J=(t,s,r)=>{const e=new R,n="pub_Sub_str-"+y;y++;let d;const b={},p=r==="localStorage"?localStorage:sessionStorage;if(r){const i=p.getItem(n);i?d=JSON.parse(i):(d={...t},p.setItem(n,JSON.stringify(d)))}else d={...t};if(s)for(const i in s)b[i]=(...o)=>{const u=f();s[i](u,...o),r&&p.setItem(n,JSON.stringify(u)),e.publish(n,u)};e.subscribe(n,i=>{d=i});function f(){return d}function C(i){const o=f();i(o),r&&p.setItem(n,JSON.stringify(o)),e.publish(n,o)}function v(i){const o=h.useRef([]),u=I(()=>{if(i){let m=new Proxy(f(),S(o.current));return i(m),m=null,i(f())}else return f()}),N=E(h.useCallback(m=>{const g=l=>{const c=i?i(l):l;w(u.current,c)||(u.current=c,m())};return e.subscribe(n,g),()=>{e.unsubscribe(n,g)}},[i,u]),h.useCallback(()=>u.current,[u])),P=h.useRef(()=>u.current),A=h.useRef(m=>{if(i){const g=m instanceof Function?m(u.current):m;let l=f();for(let c=0;c<o.current.length-1;c++)!(o.current[c]in l)&&(l[o.current[c]]=f()[o.current[c]]),l=l[o.current[c]];if(Array.isArray(g)||typeof g=="object")l[o.current[o.current.length-1]]=g,r&&p.setItem(n,JSON.stringify(f())),e.publish(n,f());else{const c=f();j(c,l,o.current[o.current.length-1],g),l=c,r&&p.setItem(n,JSON.stringify(l)),e.publish(n,l)}}else{const g=m instanceof Function?m(u.current):m;r&&p.setItem(n,JSON.stringify(g)),e.publish(n,g)}});return[N,A.current,P.current,b]}return{getStore:f,mutateStore:C,mutators:b,usePubSubStore:v}},O=J({user:{id:0,name:"",eta:0},spinner:!1},{toggleSpinner:(t,s)=>{t.spinner=s}}),{usePubSubStore:x,mutateStore:_}=O,k=()=>{const[t,s]=x(r=>r.user);return a.jsxs("div",{children:[a.jsx("label",{htmlFor:"id",children:"ID:"}),a.jsx("input",{type:"number",name:"id",value:t.id,onChange:r=>s(e=>({...e,id:Number(r.target.value)}))}),a.jsx("label",{htmlFor:"name",children:"NAME:"}),a.jsx("input",{type:"text",name:"name",value:t.name,onChange:r=>s(e=>({...e,name:r.target.value}))}),a.jsx("label",{htmlFor:"eta",children:"ETA:"}),a.jsx("input",{type:"number",name:"eta",value:t.eta,onChange:r=>s(e=>({...e,eta:Number(r.target.value)}))})]})},F=h.memo(()=>{const[t,s,,r]=x(e=>e.user.name);return a.jsxs("div",{children:[a.jsx("label",{htmlFor:"name",children:"NAME:"}),a.jsx("input",{type:"text",name:"name",value:t,onChange:e=>s(e.target.value)}),a.jsx("button",{onClick:async()=>{r.toggleSpinner(!0),await new Promise(e=>setTimeout(e,4e3)),r.toggleSpinner(!1)},children:"Enable Spinner"})]})}),q=()=>{const[t]=x(s=>s.spinner);return a.jsxs("div",{style:{display:"grid",gridTemplateRows:"auto auto",gap:20,justifyContent:"center"},children:[a.jsxs("fieldset",{style:{padding:20},children:[a.jsx("legend",{children:"Component 2"}),a.jsx(F,{})]}),t?a.jsx("p",{children:"Loading..."}):a.jsxs("fieldset",{style:{padding:20},children:[a.jsx("legend",{children:"Component 1"}),a.jsx(k,{})]})]})};export{q as CreatePubSubStore,_ as mutateStore,x as usePubSubStore};
