import{r as d,j as a}from"./index-OVRcd_HB.js";import{u as A}from"./useSyncExternalStore-XnMlxch2.js";import{P as E}from"./PublishSubscribePattern-aUbEeFKT.js";import{u as I}from"./useLazyRef-9GK7aZVN.js";import{i as R}from"./isDeepEqual-miY4iMQs.js";let b=0;function x(t){return{get(s,r){t.push(r);const e=Reflect.get(s,r);return e==null||e instanceof Blob||e instanceof Date||e instanceof RegExp||e instanceof Map||e instanceof Set||typeof e!="object"?e:new Proxy(e,x(t))}}}function y(t,s,r,e){if(t===s){t[r]=e;return}for(const n in t)if(t[n]===s){Array.isArray(t[n])?t[n]=[...t[n]]:t[n]={...t[n]},t[n][r]=e;return}else if(Array.isArray(t[n])||typeof t[n]=="object")return y(t[n],s,r,e)}const J=(t,s,r)=>{const e=new E,n="pub_Sub_str-"+b;b++;let p;const h={};if(r){const o=localStorage.getItem(n);o?p=JSON.parse(o):(p={...t},localStorage.setItem(n,JSON.stringify(p)))}else p={...t},localStorage.setItem(n,JSON.stringify(p));if(s)for(const o in s)h[o]=(...i)=>{const l=f();s[o](l,...i),r&&localStorage.setItem(n,JSON.stringify(l)),e.publish(n,l)};e.subscribe(n,o=>{p=o});function f(){return p}function j(o){const i=f();o(i),r&&localStorage.setItem(n,JSON.stringify(i)),e.publish(n,i)}function C(o){const i=d.useRef([]),l=I(()=>{if(o){let m=new Proxy(f(),x(i.current));return o(m),m=null,o(f())}else return f()}),N=A(d.useCallback(m=>{const g=u=>{const c=o?o(u):u;R(l.current,c)||(l.current=c,m())};return e.subscribe(n,g),()=>{e.unsubscribe(n,g)}},[o,l]),d.useCallback(()=>l.current,[l])),v=d.useRef(()=>l.current),P=d.useRef(m=>{if(o){const g=m instanceof Function?m(l.current):m;let u=f();for(let c=0;c<i.current.length-1;c++)!(i.current[c]in u)&&(u[i.current[c]]=f()[i.current[c]]),u=u[i.current[c]];if(Array.isArray(g)||typeof g=="object")u[i.current[i.current.length-1]]=g,r&&localStorage.setItem(n,JSON.stringify(f())),e.publish(n,f());else{const c=f();y(c,u,i.current[i.current.length-1],g),u=c,r&&localStorage.setItem(n,JSON.stringify(u)),e.publish(n,u)}}else{const g=m instanceof Function?m(l.current):m;r&&localStorage.setItem(n,JSON.stringify(g)),e.publish(n,g)}});return[N,P.current,v.current,h]}return{getStore:f,mutateStore:j,mutators:h,usePubSubStore:C}},O=J({user:{id:0,name:"",eta:0},spinner:!1},{toggleSpinner:(t,s)=>{t.spinner=s}}),{usePubSubStore:S,mutateStore:L}=O,w=()=>{const[t,s]=S(r=>r.user);return a.jsxs("div",{children:[a.jsx("label",{htmlFor:"id",children:"ID:"}),a.jsx("input",{type:"number",name:"id",value:t.id,onChange:r=>s(e=>({...e,id:Number(r.target.value)}))}),a.jsx("label",{htmlFor:"name",children:"NAME:"}),a.jsx("input",{type:"text",name:"name",value:t.name,onChange:r=>s(e=>({...e,name:r.target.value}))}),a.jsx("label",{htmlFor:"eta",children:"ETA:"}),a.jsx("input",{type:"number",name:"eta",value:t.eta,onChange:r=>s(e=>({...e,eta:Number(r.target.value)}))})]})},k=d.memo(()=>{const[t,s,,r]=S(e=>e.user.name);return a.jsxs("div",{children:[a.jsx("label",{htmlFor:"name",children:"NAME:"}),a.jsx("input",{type:"text",name:"name",value:t,onChange:e=>s(e.target.value)}),a.jsx("button",{onClick:async()=>{r.toggleSpinner(!0),await new Promise(e=>setTimeout(e,4e3)),r.toggleSpinner(!1)},children:"Enable Spinner"})]})}),_=()=>{const[t]=S(s=>s.spinner);return a.jsxs("div",{style:{display:"grid",gridTemplateRows:"auto auto",gap:20,justifyContent:"center"},children:[a.jsxs("fieldset",{style:{padding:20},children:[a.jsx("legend",{children:"Component 2"}),a.jsx(k,{})]}),t?a.jsx("p",{children:"Loading..."}):a.jsxs("fieldset",{style:{padding:20},children:[a.jsx("legend",{children:"Component 1"}),a.jsx(w,{})]})]})};export{_ as CreatePubSubStore,L as mutateStore,S as usePubSubStore};
