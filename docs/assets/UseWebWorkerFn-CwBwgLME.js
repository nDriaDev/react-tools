import{r as s,j as m}from"./index-27nyValZ.js";import{u as j}from"./useEffectOnce-DHwcJzMV.js";function f(o){return a=>{postMessage(["RUNNING"]);const r=a.data[0];return Promise.resolve(o.apply(void 0,r)).then(e=>{postMessage(["SUCCESS",e])}).catch(e=>{postMessage(["ERROR",e])})}}function R(o,a){const r=`onmessage=(${f})(${o})`,e=new Blob([r],{type:"text/javascript"});return URL.createObjectURL(e)}const b=(o,a)=>{const r=s.useRef(),e=s.useRef(""),c=s.useRef(""),n=s.useRef({resolve:void 0,reject:void 0}),u=s.useCallback((...t)=>{var l;const i=new Promise((p,d)=>{n.current={resolve:p,reject:d}});return c.current==="RUNNING"?Promise.reject(Error("Fn Worker alreay running.")):((l=r.current)==null||l.postMessage([[...t]]),i)},[]);return j(()=>(e.current=R(o),r.current=new Worker(e.current),r.current.onmessage=t=>{const[i,l]=t.data;c.current=i,i!=="RUNNING"&&(i==="SUCCESS"?n.current.resolve&&n.current.resolve(l):n.current.reject&&n.current.reject(l))},r.current.onmessageerror=t=>{n.current.reject&&n.current.reject(t.data)},r.current.onerror=t=>{n.current.reject&&n.current.reject(t)},()=>{var t;URL.revokeObjectURL(e.current),(t=r.current)==null||t.terminate(),r.current=void 0,e.current=""})),u},h=()=>{const[o,a]=s.useState(Date.now()),[r,e]=s.useState(""),c=s.useCallback(()=>Array(5e6).fill(!0).map(()=>Math.random()*11).slice(0,5).map(t=>Math.floor(t)),[]),n=b(c);return s.useEffect(()=>{const u=setInterval(()=>a(Date.now()),1);return()=>clearInterval(u)},[]),m.jsxs("div",{children:[m.jsxs("p",{children:["Timestamp: ",o]}),m.jsxs("p",{children:["Result: ",r||""]}),m.jsx("button",{onClick:()=>{e("Pending..."),e(c().join(","))},children:"Start in Main Thread"}),m.jsx("button",{onClick:()=>{e("Pending..."),n().then(u=>e(u.join(",")))},children:"Start in Web Worker"})]})};export{h as UseWebWorkerFn};
