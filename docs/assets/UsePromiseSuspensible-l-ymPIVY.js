import{r as o,j as t}from"./index-vpxvYiBV.js";import{E as m}from"./ErrorBoundary-3wx0bnRX.js";import{u as d}from"./useEffectOnce-N1eE4_ox.js";import{i as h}from"./isDeepEqual-miY4iMQs.js";const r=[];function f(a,c,i={}){let n=-1;const[,u]=o.useReducer(e=>e+1e-11,0),l=o.useRef(()=>{n!==-1&&r.splice(n,1),n=-1,u()});d(()=>()=>{i.cache==="unmount"&&(n!==-1&&r.splice(n,1),n=-1)});for(const e in r)if(h([...c,i.identifier??String.raw`${a.toString()}`],[...r[e].deps,r[e].identifier]))if(r[e].cache&&r[e].cache!=="unmount"&&Date.now()>r[e].cache){r.splice(Number(e),1);break}else{if(n=Number(e),"error"in r[e])throw i.cleanOnError&&(r[e].errorTimeout!==-1&&clearTimeout(r[e].errorTimeout),r[e].errorTimeout=setTimeout(()=>{r.splice(Number(e),1)},20)),r[e].error;if("response"in r[e])return i.invalidateManually?[r[e].response,l.current]:r[e].response;throw r[e].promise}const s={deps:c,identifier:i.identifier??String.raw`${a.toString()}`,cache:i.cache?i.cache==="unmount"?"unmount":Date.now()+i.cache*1e3:null,promise:a().then(e=>{s.response=e}).catch(e=>{s.error=e})};throw n=r.push(s)-1,s.promise}const p=()=>{const[a,c]=f(async()=>await new Promise((i,n)=>{console.log("called"),setTimeout(()=>{Math.random()>.5?i([1,2,3,4,5]):n("Error throwed by promise")},4e3)}),[],{cache:25,cleanOnError:!0,identifier:"ss",invalidateManually:!0});return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:c,children:"Invalidate"}),t.jsx("pre",{children:JSON.stringify(a)})]})},E=()=>{const a=o.useCallback((c,i,n)=>t.jsx("button",{onClick:n,children:"Retry"}),[]);return t.jsx(m,{fallback:a,children:t.jsx(o.Suspense,{fallback:"loading...",children:t.jsx(p,{})})})};export{E as UsePromiseSuspensible};
