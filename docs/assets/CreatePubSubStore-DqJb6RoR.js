import{r as d,j as s}from"./index-27nyValZ.js";import{u as E}from"./useSyncExternalStore-Atv6g5DE.js";import{P as R}from"./PublishSubscribePattern-Dz-pBZPl.js";import{u as w}from"./useLazyRef-DflU3bRA.js";import{i as N}from"./isDeepEqual-ugfbRWzt.js";let x=0;function j(t){return{get(n,a){t.push(a);const e=Reflect.get(n,a);return e==null||e instanceof Blob||e instanceof Date||e instanceof RegExp||e instanceof Map||e instanceof Set||typeof e!="object"?e:new Proxy(e,j(t))}}}function y(t,n,a,e){if(t===n){t[a]=e;return}for(const r in t)if(t[r]===n){Array.isArray(t[r])?t[r]=[...t[r]]:t[r]={...t[r]},t[r][a]=e;return}else if(Array.isArray(t[r])||typeof t[r]=="object")return y(t[r],n,a,e)}const k=(t,n,a)=>{const e=new R,r="pub_Sub_str-"+x;x++;let h;const b={};if(h={...t},n)for(const u in n)b[u]=(...i)=>{const l=f();n[u](l,...i),e.publish(r,l)};e.subscribe(r,u=>{h=u});function f(){return h}function S(u){const i=f();u(i),e.publish(r,i)}function C(u){const i=d.useRef([]),l=w(()=>{if(u){let c=new Proxy(f(),j(i.current));return u(c),c=null,u(f())}else return f()}),v=E(d.useCallback(c=>{const m=p=>{const o=u?u(p):p;N(l.current,o)||(l.current=o,c())};return e.subscribe(r,m),()=>{e.unsubscribe(r,m)}},[u,l]),d.useCallback(()=>l.current,[l])),P=d.useRef(()=>l.current),A=d.useRef(c=>{if(u){const m=c instanceof Function?c(l.current):c;let p=f();for(let o=0;o<i.current.length-1;o++)!(i.current[o]in p)&&(p[i.current[o]]=f()[i.current[o]]),p=p[i.current[o]];if(Array.isArray(m)||typeof m=="object")p[i.current[i.current.length-1]]=m,e.publish(r,f());else{const o=f();y(o,p,i.current[i.current.length-1],m),p=o,e.publish(r,p)}}else{const m=c instanceof Function?c(l.current):c;e.publish(r,m)}});return[v,A.current,P.current,b]}return{getStore:f,mutateStore:S,mutators:b,usePubSubStore:C}},F=k({user:{id:0,name:"",eta:0},spinner:!1},{toggleSpinner:(t,n)=>{t.spinner=n}}),{usePubSubStore:g,mutateStore:B}=F,D=()=>{const[t,n]=g(a=>a.user);return s.jsxs("div",{children:[s.jsx("label",{htmlFor:"id",children:"ID:"}),s.jsx("input",{type:"number",name:"id",value:t.id,onChange:a=>n(e=>({...e,id:Number(a.target.value)}))}),s.jsx("label",{htmlFor:"name",children:"NAME:"}),s.jsx("input",{type:"text",name:"name",value:t.name,onChange:a=>n(e=>({...e,name:a.target.value}))}),s.jsx("label",{htmlFor:"eta",children:"ETA:"}),s.jsx("input",{type:"number",name:"eta",value:t.eta,onChange:a=>n(e=>({...e,eta:Number(a.target.value)}))})]})},M=d.memo(()=>{const[t,n,,a]=g(e=>e.user.name);return s.jsxs("div",{children:[s.jsx("label",{htmlFor:"name",children:"NAME:"}),s.jsx("input",{type:"text",name:"name",value:t,onChange:e=>n(e.target.value)}),s.jsx("button",{onClick:async()=>{a.toggleSpinner(!0),await new Promise(e=>setTimeout(e,4e3)),a.toggleSpinner(!1)},children:"Enable Spinner"})]})}),I=()=>{const[t]=g(n=>n.spinner);return s.jsxs("div",{style:{display:"grid",gridTemplateRows:"auto auto",gap:20,justifyContent:"center"},children:[s.jsxs("fieldset",{style:{padding:20},children:[s.jsx("legend",{children:"Component 2"}),s.jsx(M,{})]}),t?s.jsx("p",{children:"Loading..."}):s.jsxs("fieldset",{style:{padding:20},children:[s.jsx("legend",{children:"Component 1"}),s.jsx(D,{})]})]})};export{I as CreatePubSubStore,B as mutateStore,g as usePubSubStore};
