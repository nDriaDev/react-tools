var h=Object.defineProperty;var l=(e,s,t)=>s in e?h(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var b=(e,s,t)=>(l(e,typeof s!="symbol"?s+"":s,t),t);import{r as i,j as c}from"./index-7b09dd01.js";class p{constructor(){b(this,"topics");this.topics=new Map}subscribe(s,t){this.topics.has(s)||this.topics.set(s,[]);const u=this.topics.get(s);u.push(t),this.topics.set(s,u)}unsubscribe(s,t){if(!this.topics.has(s))return!1;const u=this.topics.get(s).filter(r=>r!==t);return this.topics.set(s,u),!0}async publish(s,t){const u=this.topics.get(s)??[],r=[];u.forEach(o=>r.push(o(t))),await Promise.allSettled(r)}}const n=new p,a=e=>{const s=i.useRef(async u=>await n.publish(e,u)),t=i.useRef(u=>(n.subscribe(e,u),()=>{n.unsubscribe(e,u)}));return i.useEffect(()=>()=>{const u=n.topics.get(e);u==null||u.forEach(r=>n.unsubscribe(e,r))},[e]),[t.current,s.current]},f=i.memo(()=>{const[,e]=a("demo"),s=i.useCallback(t=>{e({value:t.target.value})},[e]);return c.jsx("input",{type:"text",onChange:s})}),m=()=>{const[e,s]=i.useState({value:""}),[t]=a("demo");return i.useEffect(()=>{const u=t(r=>{r&&s(r)});return()=>{u()}},[t]),c.jsxs("div",{children:[c.jsxs("p",{children:["Value is: ",e.value]}),c.jsx(f,{})]})};m.displayName="UsePublishSubscribe";export{m as UsePublishSubscribe};
